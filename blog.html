<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blog | Om Nagvekar</title>

  <!-- Fonts & libs -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Highlight.js styles for light and dark (we'll enable/disable via JS) -->
  <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">

  <!-- Highlight.js core -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <style>
    :root{
      --bg: #ffffff;
      --muted: #6b7280;
      --text: #0f172a;
      --accent: #2e7d32;
      --card: #f8faf9;
      --glass: rgba(255,255,255,0.6);
      --radius: 12px;
      --code-bg: #f4f6f8;         /* light code background */
      --code-color: #0b1220;
      --inline-code-bg: rgba(0,0,0,0.03);
      --shadow: 0 8px 30px rgba(16,24,40,0.06);
      --max-width: 980px;
      --copy-btn-bg: rgba(0,0,0,0.06);
      --copy-btn-color: #071129;
    }
    [data-theme="dark"]{
      --bg: #061323;
      --muted: #9aa6b2;
      --text: #e6eef6;
      --accent: #7bd389;
      --card: #071c2b;
      --glass: rgba(8,14,20,0.5);
      --code-bg: #011627;        /* dark code background */
      --code-color: #dbeafe;
      --inline-code-bg: rgba(255,255,255,0.03);
      --shadow: 0 10px 40px rgba(0,0,0,0.6);
      --copy-btn-bg: rgba(255,255,255,0.04);
      --copy-btn-color: #e6eef6;
    }

    html,body { height:100%; }
    body{
      margin:0;
      font-family: Inter, Roboto, system-ui, -apple-system, "Segoe UI", "Helvetica Neue", Arial;
      background: var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      transition: background 220ms ease, color 220ms ease;
    }

    /* Topbar */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 18px;
      gap:12px;
      position:sticky;
      top:0;
      z-index:40;
      backdrop-filter: blur(6px);
      background: linear-gradient(180deg, rgba(255,255,255,0.75), rgba(255,255,255,0.55));
      border-bottom: 1px solid rgba(0,0,0,0.06);
    }
    [data-theme="dark"] .topbar{
      background: linear-gradient(180deg, rgba(7,17,41,0.6), rgba(7,17,41,0.4));
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .brand { display:flex; align-items:center; gap:12px; text-decoration:none; color:var(--text); }
    .brand h2 { margin:0; font-size:1rem; font-weight:700; }

    .controls { display:flex; gap:10px; align-items:center; }

    .btn {
      border: none;
      background: var(--accent);
      color: #fff;
      padding:7px 12px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
      font-size:0.9rem;
    }
    .btn.secondary { background: transparent; color:var(--text); border:1px solid rgba(0,0,0,0.06); }
    .btn.ghost { background: transparent; border:1px dashed rgba(0,0,0,0.06); color:var(--muted); }

    /* Layout */
    .layout{
      display:grid;
      grid-template-columns: 1fr min(820px, var(--max-width)) 300px;
      gap:28px;
      align-items:start;
      max-width: 1400px;
      margin: 28px auto;
      padding: 0 20px 80px;
    }

    /* content card */
    .content {
      position: relative;
      z-index: 50;
      overflow: visible;
      background: var(--card);
      border-radius: 12px;
      padding: 26px;
      box-shadow: var(--shadow);
      transition: background 200ms ease, box-shadow 200ms ease;
    }

    .post-title { margin:0 0 10px 0; font-size:1.6rem; color:var(--text); font-weight:700; }
    .post-meta { display:flex; gap:8px; align-items:center; color:var(--muted); margin-bottom:16px; font-size:0.95rem; }

    /* Featured image should match article/content width */
    /* Force any images in the article / featured image to fit column */
    .content img,
    .featured-img {
      display: block !important;
      width: 100% !important;       /* fill the article column */
      max-width: 100% !important;   /* never exceed the column */
      height: auto !important;      /* preserve aspect ratio */
      object-fit: contain !important; /* preserve full image, change to cover if you want cropping */
      margin-left: 0 !important;
      margin-right: 0 !important;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }


    /* markdown content */
    article#post { font-size:1rem; color:var(--text); line-height:1.75; }
    article#post h1, article#post h2, article#post h3 { color:var(--accent); margin-top:1.4em; margin-bottom:0.4em; font-weight:700; }
    article#post p { margin:0 0 1em 0; }
    article#post a { color:var(--accent); text-decoration:underline; text-underline-offset:3px; }
    article#post blockquote { border-left:4px solid var(--accent); padding:12px 14px; margin: 0.8em 0; background: rgba(0,0,0,0.02); color:var(--muted); border-radius:8px; font-style:italic; }

    /* inline code */
    article#post code.inline {
      font-family: "Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
      background: var(--inline-code-bg);
      padding: 2px 6px;
      border-radius:6px;
      font-size:0.95em;
      color:var(--code-color);
    }

    /* code blocks */
    pre {
      margin: 1em 0;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      background: var(--code-bg);
      color: var(--code-color);
      padding: 12px;
      font-family: "Roboto Mono", "Courier New", monospace;
      font-size: 0.95rem;
      line-height:1.45;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
    }
    pre code {
      display: block;
      white-space: pre;
      tab-size: 2;
      outline: none;
    }

    /* ensure highlight.js tokens visible - override some defaults */
    .hljs {
      background: transparent; /* we use pre background */
      color: var(--code-color);
      font-family: "Roboto Mono", monospace;
      font-size: 0.95rem;
    }
    /* tweak typical token colors (fallback if theme leaves them too dim) */
    .hljs-comment, .hljs-quote { color: #7c8a97; font-style: italic; }
    .hljs-keyword, .hljs-selector-tag, .hljs-subst { color: #ff6b6b; font-weight:600; }
    .hljs-literal, .hljs-number, .hljs-tag .hljs-attr { color: #d19a66; }
    .hljs-string, .hljs-doctag { color: #7bd389; }
    .hljs-title, .hljs-section, .hljs-selector-id { color: #f3c623; font-weight:700; }
    .hljs-built_in, .hljs-builtin-name, .hljs-type { color: #ff9e64; }

    /* copy button */
    .code-toolbar {
      position: absolute;
      right: 8px;
      top: 8px;
      display:flex;
      gap:6px;
      z-index:10;
    }
    .copy-btn {
      font-family: Inter, sans-serif;
      padding:6px 8px;
      border-radius:8px;
      border: none;
      background: var(--copy-btn-bg);
      color: var(--copy-btn-color);
      cursor:pointer;
      font-size:0.82rem;
    }
    .copy-btn:focus { outline:2px solid rgba(0,0,0,0.08); }

    /* sidebar toc */
    .sidebar { position:sticky; z-index: 10; top:84px; align-self:start; max-height:calc(100vh - 120px); overflow:auto; }
    .toc { padding:12px; background: rgba(255,255,255,0.02); border-radius:10px; margin-bottom:14px; border:1px solid rgba(0,0,0,0.04); }
    .toc h4 { margin:0 0 8px 0; color:var(--muted); }
    .toc a { color:var(--text); text-decoration:none; font-size:0.95rem; }

    /* reading progress */
    .progress-wrap { position:fixed; left:0; top:0; width:100%; height:4px; z-index:60; background:transparent; }
    .progress { height:4px; width:0%; background:linear-gradient(90deg,var(--accent), #7bd389); transition: width 0.12s linear; }

    /* responsive */
    @media (max-width:1100px){ .layout { grid-template-columns: 1fr min(820px, 100%); } .sidebar{display:none;} }
    @media (max-width:760px){ .topbar{padding:10px;} .content{padding:16px;} pre{font-size:0.92rem;} }

    /* focus visible accessibility */
    :focus { outline: 2px solid rgba(43, 128, 110, 0.18); outline-offset: 2px; border-radius:6px; }
    /* --- IMAGE / SIDEBAR STACKING FIX (paste AFTER existing CSS) --- */

    /* Ensure content card sits above the sidebar */
    .content {
      position: relative;   /* enable z-index */
      z-index: 50;          /* higher than sidebar */
      overflow: visible;    /* allow image to render fully inside the card */
    }

    /* Constrain featured image safely inside content card */
    .featured-img {
      display: block !important;
      width: 100% !important;
      height: auto !important;
      max-height: 66vh;         /* prevents overly tall images; adjust if you want higher */
      object-fit: contain;      /* preserve aspect ratio without cropping important parts */
      border-radius: 10px;
      margin: 12px 0 18px;
      position: relative;
      z-index: 51;              /* ensure image sits above sidebar visually */
      box-shadow: 0 6px 24px rgba(0,0,0,0.12);
    }

    /* Make sidebar visually distinct and put it below content in stacking order */
    .sidebar {
      position: sticky;
      top: 84px;
      z-index: 10;              /* lower than .content */
      background: rgba(255,255,255,0.95); /* nearly solid so it doesn't visually wash over images */
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.06);
      overflow: auto;
    }

    /* Dark theme tweak for sidebar background to keep contrast but opaque */
    [data-theme="dark"] .sidebar {
      background: rgba(9,14,18,0.92);
      border: 1px solid rgba(255,255,255,0.03);
    }

    /* Responsive: hide sidebar on smaller screens to avoid overlap */
    @media (max-width:1100px){
      .sidebar { display: none; }
      .layout { grid-template-columns: 1fr min(100%, var(--max-width)); }
    }

  </style>
  <style>
    /* Scroll to Top Button */
    #scrollToTopBtn {
      position: fixed;
      bottom: 28px;
      right: 28px;
      z-index: 70;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 46px;
      height: 46px;
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
      display: none; /* hidden by default */
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      transition: opacity 0.3s ease, transform 0.25s ease;
    }

    #scrollToTopBtn:hover {
      background: #256d27;
      transform: translateY(-2px);
    }

    [data-theme="dark"] #scrollToTopBtn {
      background: var(--accent);
      color: #fff;
    }
  </style>

</head>
<body data-theme="light">
  <div class="progress-wrap" aria-hidden="true"><div class="progress" id="readingProgress"></div></div>

  <header class="topbar" role="banner">
    <a class="brand" href="index.html" aria-label="Back to portfolio">
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="border-radius:8px;">
        <rect width="24" height="24" rx="6" fill="var(--accent)"></rect>
        <text x="50%" y="56%" dominant-baseline="middle" text-anchor="middle" font-size="12" font-weight="700" fill="#fff">OM</text>
      </svg>
      <h2>Om Nagvekar — Blog</h2>
    </a>

    <div class="controls" role="navigation" aria-label="page controls">
      <button id="toggleTheme" class="btn secondary" title="Toggle dark / light">Toggle theme</button>
      <a class="btn" href="index.html">Back to Portfolio</a>
    </div>
  </header>

  <main class="layout" role="main" aria-live="polite">
    <div></div>

    <section class="content" aria-labelledby="postTitle">
      <h1 id="postTitle" class="post-title">Loading…</h1>
      <div class="post-meta">
        <div id="postDate" class="muted">—</div>
        <div id="readTime" class="muted">—</div>
      </div>

      <img id="featuredImage" class="featured-img" alt="" style="display:none;">

      <article id="post"><p>Loading post content…</p></article>

      <hr style="margin:20px 0; border:none; border-top:1px solid rgba(0,0,0,0.06)">

      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
        <div style="display:flex; gap:8px;">
          <button id="shareTwitter" class="btn secondary" title="Share on Twitter">Share</button>
          <button id="copyLink" class="btn secondary" title="Copy link">Copy link</button>
          <a id="emailShare" class="btn secondary" href="#" title="Share by email">Email</a>
        </div>
        <div class="muted">Thanks for reading — <strong>Om</strong></div>
      </div>
    </section>

    <aside class="sidebar" aria-label="Table of contents and related">
      <nav class="toc" id="toc" aria-label="Table of contents">
        <h4>Contents</h4>
        <ul id="tocList"><li class="muted">Loading…</li></ul>
      </nav>

      <div class="toc" aria-label="About author" style="margin-top:14px;">
        <h4>About the author</h4>
        <p class="muted">Om Nagvekar — Data Scientist & AI researcher. <a href="index.html">Portfolio</a></p>
      </div>
    </aside>
    <button id="scrollToTopBtn">&#8679;</button>
  </main>

  <script>
    // --- config ---
    const githubOwner = "OmNagvekar";
    const githubRepo = "omnagvekar.github.io";
    const branch = "main";
    const blogsPath = "blogs";

    // enable light/dark highlight.css based on theme
    const hlLightLink = document.getElementById('hljs-light');
    const hlDarkLink = document.getElementById('hljs-dark');

    function setTheme(theme) {
      document.body.setAttribute('data-theme', theme);
      // highlight css toggling: enable correct stylesheet
      if (theme === 'dark') {
        hlLightLink.disabled = true;
        hlDarkLink.disabled = false;
      } else {
        hlLightLink.disabled = false;
        hlDarkLink.disabled = true;
      }
      localStorage.setItem('blog_theme', theme);
    }
    // load saved theme or system
    (function(){
      const saved = localStorage.getItem('blog_theme');
      if (saved) setTheme(saved);
      else {
        // prefer user OS pref
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        setTheme(prefersDark ? 'dark' : 'light');
      }
    })();

    document.getElementById('toggleTheme').addEventListener('click', () => {
      const cur = document.body.getAttribute('data-theme') || 'light';
      setTheme(cur === 'light' ? 'dark' : 'light');
    });

    // fetch markdown
    async function fetchMarkdown(fileName) {
      const url = `https://raw.githubusercontent.com/${githubOwner}/${githubRepo}/${branch}/${blogsPath}/${fileName}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Post not found on GitHub.");
      return await res.text();
    }

    // helpers
    function estimateReadingTime(text) {
      const words = text.trim().split(/\s+/).length;
      const wpm = 200;
      return Math.max(1, Math.round(words / wpm)) + ' min read';
    }
    function extractTitle(md) {
      const m = md.match(/^\s*#\s+([^\n\r]+)/m);
      return m ? m[1].trim() : null;
    }
    function fixImagePath(path) {
      // If absolute URL (http/https), return as is
      if (/^https?:\/\//i.test(path)) return path;
      // Otherwise, assume it's relative to your GitHub repo blogs folder
      return `https://raw.githubusercontent.com/${githubOwner}/${githubRepo}/${branch}/${blogsPath}/${path}`;
    }
    function findFeaturedImage(md) {
      const fm = md.match(/featured:\s*(.+)/i);
      if (fm) return fm[1].trim();
      const img = md.match(/!\[.*?\]\((.*?)\)/);
      return img ? fixImagePath(img[1]) : null;
    }
    // --- tiny runtime fixes for featured image paths + safe rendering ---
    // ensure featured image respects container and uses lazy loading
    (function fixFeaturedImage() {
      const f = document.getElementById('featuredImage');
      if (!f) return;
      f.loading = 'lazy';
      // make sure CSS rules above always apply
      f.style.display = 'block';
      f.style.width = '100%';
      f.style.height = 'auto';
      f.style.objectFit = 'contain';
      f.style.maxHeight = '66vh';
      f.style.zIndex = '51';
      // accessibility fallback for alt text
      if (!f.alt) f.alt = (document.getElementById('postTitle')?.textContent || 'Featured image');
    })();


    // --- Force featured image to match content width at runtime ---
    (function ensureFeaturedFits() {
      const adjust = () => {
        const content = document.querySelector('.content');
        const img = document.getElementById('featuredImage');
        if (!content || !img) return;
        // ensure CSS applied
        img.style.display = 'block';
        img.style.width = '100%';
        img.style.maxWidth = '100%';
        img.style.height = 'auto';
        img.style.objectFit = 'contain';
        // If image loaded but still too big due to weird CSS, explicitly set maxWidth in px
        const cw = content.clientWidth;
        if (cw) img.style.maxWidth = cw + 'px';
      };

      // run after image loads (if it's set later) and once now
      const img = document.getElementById('featuredImage');
      if (img) {
        if (!img.complete) img.addEventListener('load', adjust);
        adjust();
      }
      window.addEventListener('resize', adjust);
      // also re-run shortly after DOM changes
      setTimeout(adjust, 400);
    })();


    // render markdown
    function renderMarkdown(md) {
      // treat inline code specially: add class "inline" to inline code for styling
      marked.setOptions({ gfm:true, headerIds:true, mangle:false, breaks:false });
      // small renderer override to mark inline code
      const renderer = new marked.Renderer();
      const originalCode = renderer.code.bind(renderer);
      renderer.code = (code, infostring, escaped) => {
        return originalCode(code, infostring, escaped);
      };
      const originalCodespan = renderer.codespan.bind(renderer);
      renderer.codespan = (text) => `<code class="inline">${text}</code>`;
      return marked.parse(md, { renderer });
    }

    // generate TOC
    function buildTOC(container) {
      const headers = container.querySelectorAll('h2, h3');
      const tocList = document.getElementById('tocList');
      tocList.innerHTML = '';
      if (!headers.length) { tocList.innerHTML = '<li class="muted">No sections</li>'; return; }
      headers.forEach(h => {
        if (!h.id) {
          h.id = h.textContent.trim().toLowerCase().replace(/\s+/g,'-').replace(/[^\w\-]+/g,'');
        }
        const li = document.createElement('li');
        li.style.marginLeft = h.tagName.toLowerCase() === 'h3' ? '10px' : '0';
        const a = document.createElement('a');
        a.href = `#${h.id}`;
        a.textContent = h.textContent;
        a.onclick = (e) => { e.preventDefault(); document.getElementById(h.id).scrollIntoView({behavior:'smooth', block:'start'}); };
        li.appendChild(a);
        tocList.appendChild(li);
      });
    }

    // apply syntax highlighting and add copy buttons
    function enhanceCodeBlocks() {
      document.querySelectorAll('pre code').forEach((block) => {
        try { hljs.highlightElement(block); } catch(e){ /* ignore */ }

        // attach toolbar only once
        const pre = block.parentElement;
        if (!pre) return;
        if (pre.querySelector('.code-toolbar')) return;

        const toolbar = document.createElement('div');
        toolbar.className = 'code-toolbar';
        const btn = document.createElement('button');
        btn.className = 'copy-btn';
        btn.textContent = 'Copy';
        btn.title = 'Copy code';
        toolbar.appendChild(btn);
        pre.appendChild(toolbar);

        btn.addEventListener('click', async (e) => {
          try {
            await navigator.clipboard.writeText(block.innerText);
            btn.textContent = 'Copied!';
            setTimeout(()=> btn.textContent = 'Copy', 1400);
          } catch {
            btn.textContent = 'Failed';
            setTimeout(()=> btn.textContent = 'Copy', 1400);
          }
        });
      });
    }

    // reading progress
    function updateProgress() {
      const progress = document.getElementById('readingProgress');
      const post = document.getElementById('post');
      const total = post.scrollHeight - window.innerHeight;
      if (total <= 0) { progress.style.width = '100%'; return; }
      const scrolled = Math.min(1, Math.max(0, window.scrollY / total));
      progress.style.width = (scrolled * 100) + '%';
    }

    // share helpers
    function setupShare() {
      const pageUrl = location.href;
      const tweet = `https://twitter.com/intent/tweet?text=${encodeURIComponent(document.title)}&url=${encodeURIComponent(pageUrl)}`;
      document.getElementById('shareTwitter').onclick = () => window.open(tweet, '_blank', 'noopener');
      document.getElementById('copyLink').onclick = async () => {
        try { await navigator.clipboard.writeText(pageUrl); alert('Link copied to clipboard'); }
        catch { alert('Copy failed — please copy manually'); }
      };
      document.getElementById('emailShare').href = `mailto:?subject=${encodeURIComponent(document.title)}&body=${encodeURIComponent(pageUrl)}`;
    }

    // Scroll-to-Top Button
    const scrollToTopBtn = document.getElementById('scrollToTopBtn');
    window.addEventListener('scroll', () => {
      document.querySelector('header')
        .classList.toggle('small', window.scrollY > 100);
      if (window.scrollY > 300) {
        scrollToTopBtn.style.display = 'block';
      } else {
        scrollToTopBtn.style.display = 'none';
      }
    });
    scrollToTopBtn.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // main
    (async function(){
      const params = new URLSearchParams(window.location.search);
      const file = params.get('post');
      if (!file) {
        document.getElementById('post').innerHTML = `<p style="color:#b00020">No post specified. Go back to <a href="index.html">portfolio</a>.</p>`;
        return;
      }
      try {
        const raw = await fetchMarkdown(file);
        const title = extractTitle(raw) || file.replace(/\.md$/i,'');
        const img = findFeaturedImage(raw);
        document.getElementById('postTitle').textContent = title;
        document.getElementById('postDate').textContent = (new Date()).toLocaleDateString();
        document.getElementById('readTime').textContent = estimateReadingTime(raw);

        if (img) {
          const f = document.getElementById('featuredImage');
          f.src = img;
          f.alt = title + ' — featured image';
          f.style.display = 'block';
        }

        // render
        const rendered = renderMarkdown(raw);
        const postEl = document.getElementById('post');
        postEl.innerHTML = rendered;

        // ensure inline code gets class "inline" by renderer; do highlight
        enhanceCodeBlocks();

        buildTOC(postEl);
        setupShare();

        updateProgress();
        window.addEventListener('scroll', updateProgress);
        window.addEventListener('resize', updateProgress);
        document.title = `${title} — Om Nagvekar`;
      } catch (err) {
        document.getElementById('post').innerHTML = `<p style="color:#b00020">${err.message}</p>`;
      }
    })();
  </script>
</body>
</html>
